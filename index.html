<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PCEP Mock Exam ‚Äì NewGen Robotics</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #eef1f5;
    }

    .header {
        background: #19376D;
        color: white;
        padding: 12px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 18px;
        flex-wrap: wrap;
    }

    .header span {
        word-break: break-all;
    }

    .layout {
        display: flex;
        height: calc(100vh - 60px);
    }

    /* Sidebar */
    .sidebar {
        width: 220px;
        background: #0B2447;
        color: white;
        padding: 15px;
        overflow-y: auto;
        flex-shrink: 0;
    }

    .sidebar h3 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 16px;
    }

    .q-btn {
        display: inline-block;
        width: 40px;
        height: 40px;
        margin: 4px;
        background: #576CBC;
        color: white;
        border-radius: 6px;
        text-align: center;
        line-height: 40px;
        cursor: pointer;
        font-size: 14px;
        user-select: none;
        transition: 0.2s;
    }

    .q-btn:hover {
        background: #A5D7E8;
        color: #0B2447;
    }

    .q-answered {
        background: #4CAF50 !important;
    }

    .q-current {
        outline: 2px solid yellow;
    }

    .q-locked {
        cursor: not-allowed;
        opacity: 0.6;
    }

    /* Right Side (Questions) */
    .main {
        flex: 1;
        padding: 18px;
        overflow-y: auto;
    }

    #timer {
        font-size: 20px;
        font-weight: bold;
        color: #d9534f;
        margin-bottom: 12px;
    }

    .progress {
        height: 8px;
        background: #ccc;
        border-radius: 4px;
        margin-bottom: 12px;
        overflow: hidden;
    }

    .progress-bar {
        height: 8px;
        background: #19376D;
        width: 0%;
        transition: width 0.3s;
    }

    .question-box {
        background: #fff;
        padding: 16px;
        border-radius: 12px;
        box-shadow: 0 0 10px #ccc;
    }

    .question-box h2 {
        margin-top: 0;
        margin-bottom: 8px;
        font-size: 20px;
    }

    .question-meta {
        font-size: 13px;
        color: #666;
        margin-bottom: 10px;
    }

    .options label {
        display: block;
        background: #f7f7f7;
        padding: 12px;
        margin: 8px 0;
        border-radius: 6px;
        cursor: pointer;
        border: 1px solid #ddd;
        font-size: 15px;
    }

    .options input {
        margin-right: 10px;
    }

    /* Buttons */
    .nav-buttons {
        margin-top: 18px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    button {
        padding: 12px 20px;
        background: #19376D;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
        min-width: 110px;
    }

    button:hover {
        background: #0B2447;
    }

    button:disabled {
        background: #999;
        cursor: not-allowed;
    }

    /* Result Overlay */
    .result-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 999;
        padding: 20px;
    }

    .result-box {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        max-width: 430px;
        width: 100%;
        text-align: center;
        box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }

    .result-box button {
        width: 100%;
        margin-top: 12px;
    }

    .small-note {
        font-size: 12px;
        color: #666;
    }

    /* üì± MOBILE RESPONSIVE FIXES */
    @media (max-width: 900px) {
        .layout {
            flex-direction: column;
            height: auto;
        }

        .sidebar {
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding-bottom: 10px;
            max-height: 200px;
        }

        .main {
            height: auto;
        }

        .q-btn {
            width: 38px;
            height: 38px;
            line-height: 38px;
            font-size: 13px;
        }
    }

    @media (max-width: 600px) {
        .header {
            font-size: 16px;
            padding: 10px;
        }

        #timer {
            font-size: 18px;
        }

        .question-box {
            padding: 14px;
        }

        .options label {
            font-size: 14px;
            padding: 10px;
        }

        button {
            font-size: 14px;
            padding: 10px;
            min-width: 100px;
        }

        .result-box {
            padding: 16px;
            max-width: 350px;
        }
    }
</style>

</head>
<body oncontextmenu="return false;">

<div class="header">
    <div>PCEP Mock Exam ‚Äì Secure</div>
    <div style="font-size: 12px;">
        Exam ID: <span id="examId"></span>
    </div>
</div>

<div class="layout">

    <div class="sidebar">
        <h3>Questions</h3>
        <div id="questionButtons"></div>
    </div>

    <div class="main">
        <div id="timer"></div>

        <div class="progress">
            <div id="progressBar" class="progress-bar"></div>
        </div>

        <div id="quiz"></div>

        <div class="nav-buttons">
            <button id="prevBtn" onclick="prevQuestion()">Previous</button>
            <button id="nextBtn" onclick="nextQuestion()">Next</button>
            <button id="submitBtn" onclick="submitQuiz()">Submit</button>
        </div>
    </div>
</div>

<div id="resultOverlay" class="result-overlay">
    <div class="result-box">
        <h2>Exam Finished</h2>
        <p id="resultText"></p>
        <p class="small-note">
            Answers are locked. This result cannot be changed.
        </p>

        <button onclick="copyAnswers()" style="
            padding:10px 16px;
            margin-top:10px;
            background:#4CAF50;
            color:white;
            border:none;
            border-radius:6px;
            cursor:pointer;
            font-size:14px;
        ">
            Copy Answers
        </button>


    </div>
</div>

<script>
/* ===========================
   1. Seeded RNG utilities
   =========================== */
// Deterministic PRNG ‚Äì mulberry32
function mulberry32(a) {
    return function() {
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
    };
}

// Seeded shuffle
function seededShuffle(array, seed) {
    const rand = mulberry32(seed);
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(rand() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

/* ===========================
   2. Raw question bank
   - mix of easy/medium/hard
   - with set: 'A' | 'B' | 'C'
   =========================== */

const rawQuestions = [
    // --- SET A (PCEP basics, easy/medium) ---
    { set: "A", level: "easy",
      q: "What is the type of 3.14 in Python?",
      options: ["int", "float", "str", "complex"],
      answer: 1 },
    { set: "A", level: "easy",
      q: "Which is a valid variable name?",
      options: ["1name", "first_name", "for", "user-name"],
      answer: 1 },
    { set: "A", level: "easy",
      q: "Which operator is used for exponentiation?",
      options: ["^", "**", "//", "exp()"],
      answer: 1 },
    { set: "A", level: "easy",
      q: "What does len('Python') return?",
      options: ["5", "6", "7", "Error"],
      answer: 1 },
    { set: "A", level: "medium",
      q: "Result of: a=5; b=2.0; print(a + b)?",
      options: ["7", "7.0", "7.00", "Error"],
      answer: 1 },
    { set: "A", level: "medium",
      q: "Which checks if n is even?",
      options: ["n/2 == 0", "n%2 == 0", "n//2 == 0", "n == 2"],
      answer: 1 },
    { set: "A", level: "medium",
      q: "What is output: s='hello'; print(s[1:4])?",
      options: ["he", "hel", "ell", "ello"],
      answer: 2 },
    { set: "A", level: "medium",
      q: "Which is true for tuples?",
      options: ["Mutable", "Use []", "Immutable", "Have .append()"],
      answer: 2 },
    { set: "A", level: "medium",
      q: "What does list(range(2, 7, 2)) equal?",
      options: ["[2,3,4,5,6]", "[2,4,6]", "[2,4]", "[2,3,4,5]"],
      answer: 1 },
    { set: "A", level: "hard",
      q: "Output: L=[1,2,3]; L[1]=L[1]+L[2]; print(L)?",
      options: ["[1,2,3]", "[1,5,3]", "[3,2,3]", "[1,2,5]"],
      answer: 1 },

    // --- SET B (control flow, collections, a bit harder) ---
    { set: "B", level: "easy",
      q: "Which keyword starts a function definition?",
      options: ["func", "def", "function", "define"],
      answer: 1 },
    { set: "B", level: "easy",
      q: "Which takes input from user?",
      options: ["scan()", "input()", "read()", "gets()"],
      answer: 1 },
    { set: "B", level: "easy",
      q: "Which loop runs exactly 5 times?",
      options: ["for i in range(5)", "for i in range(1,5)", "for i in range(0,6)", "while True"],
      answer: 0 },
    { set: "B", level: "medium",
      q: "What does break do in a loop?",
      options: ["Skips iteration", "Ends loop", "Pauses loop", "Restarts loop"],
      answer: 1 },
    { set: "B", level: "medium",
      q: "While output: n=3; while n>0: print(n,end=' '); n-=1",
      options: ["3 2 1", "1 2 3", "3 2", "2 1"],
      answer: 0 },
    { set: "B", level: "medium",
      q: "Which is NOT a mutable type?",
      options: ["list", "dict", "tuple", "set"],
      answer: 2 },
    { set: "B", level: "medium",
      q: "Dict d={'a':1,'b':2}. How to get value 2?",
      options: ["d.b", "d['b']", "d.get('c')", "d(1)"],
      answer: 1 },
    { set: "B", level: "medium",
      q: "Which raises KeyError?",
      options: ["d['x']", "d.get('x')", "len(d)", "'x' in d"],
      answer: 0 },
    { set: "B", level: "hard",
      q: "Output: x=5; if x>5: print('A') elif x==5: print('B') else: print('C')",
      options: ["A", "B", "C", "Nothing"],
      answer: 1 },
    { set: "B", level: "hard",
      q: "Output: L=[10,20,30,40]; print(L[-3])",
      options: ["10", "20", "30", "40"],
      answer: 1 },

    // --- SET C (functions, errors, slightly advanced logic) ---
    { set: "C", level: "easy",
      q: "What is raised by 5/0 in Python?",
      options: ["ValueError", "ZeroDivisionError", "TypeError", "IndexError"],
      answer: 1 },
    { set: "C", level: "easy",
      q: "Which imports only sqrt from math?",
      options: ["import math.sqrt", "from math import sqrt", "include math.sqrt", "using math.sqrt"],
      answer: 1 },
    { set: "C", level: "easy",
      q: "Convert '123' to integer:",
      options: ["int('123')", "str(123)", "float('123')", "bool('123')"],
      answer: 0 },
    { set: "C", level: "medium",
      q: "Output: def f(x): return x*2; print(f(3))",
      options: ["3", "6", "None", "Error"],
      answer: 1 },
    { set: "C", level: "medium",
      q: "Output: s='PCEP'; print(s.lower())",
      options: ["PCEP", "pcep", "Error", "pcEp"],
      answer: 1 },
    { set: "C", level: "medium",
      q: "Which checks if list L is non-empty?",
      options: ["if len(L)>0", "if L", "if L!=[]", "All of these"],
      answer: 3 },
    { set: "C", level: "medium",
      q: "Which statement is true about strings?",
      options: ["Mutable", "Immutable", "Support += but change in-place", "Cannot be indexed"],
      answer: 1 },
    { set: "C", level: "hard",
      q: "Output: x=0; for i in range(3): x+=i; print(x)",
      options: ["0", "3", "6", "Error"],
      answer: 1 },
    { set: "C", level: "hard",
      q: "Output: L=[1,2,3]; print(L*2)",
      options: ["[1,2,3,1,2,3]", "[2,4,6]", "[1,2,3,2]", "Error"],
      answer: 0 },
    { set: "C", level: "hard",
      q: "What is result of '5' + '5'?",
      options: ["10", "'10'", "'55'", "Error"],
      answer: 2 },

    // --- EXTRA MIXED (tag them to any set to grow bank) ---
    { set: "A", level: "hard",
      q: "Output: a=True; b=False; print(a and not b)",
      options: ["True", "False", "None", "Error"],
      answer: 0 },
    { set: "B", level: "hard",
      q: "Which line causes a TypeError?",
      options: ["'3' + '4'", "3 + 4", "'3' * 3", "3 + '4'"],
      answer: 3 },
    { set: "C", level: "medium",
      q: "Which is a valid list literal?",
      options: ["(1,2,3)", "[1,2,3]", "{1,2,3}", "<1,2,3>"],
      answer: 1 },
    { set: "A", level: "medium",
      q: "Output: t=(1,2,3); print(len(t))",
      options: ["2", "3", "4", "Error"],
      answer: 1 },
    { set: "B", level: "medium",
      q: "Which loop will never execute?",
      options: ["for i in range(0)", "for i in range(1)", "for i in range(1,1)", "Both 1 and 3"],
      answer: 3 },
    { set: "C", level: "medium",
      q: "What is type of []?",
      options: ["list", "tuple", "dict", "set"],
      answer: 0 },
    { set: "A", level: "medium",
      q: "Which expression is True?",
      options: ["3 == '3'", "3 != 3.0", "3 == 3.0", "'a' > 'b'"],
      answer: 2 },
    { set: "B", level: "hard",
      q: "Output: for i in range(1,4):\n    if i==2: continue\n    print(i,end=' ')",
      options: ["1 2 3", "1 3", "2 3", "1 2"],
      answer: 1 },
    { set: "C", level: "hard",
      q: "Which call will raise IndexError for L=[1,2,3]?",
      options: ["L[0]", "L[2]", "L[-1]", "L[3]"],
      answer: 3 },
    { set: "A", level: "hard",
      q: "Output: d={'x':1}; d['y']=2; print(len(d))",
      options: ["1", "2", "3", "Error"],
      answer: 1 }
];

/*
NOTE:
Right now bank has 30 questions.
To expand to 60/100, just keep adding objects in the same format.
You can balance sets A/B/C however you like.
*/

/* ===========================
   3. Build exam from seed
   =========================== */

let examQuestions = [];
let userAnswers = [];
let current = 0;
let examSubmitted = false;

const seed = Math.floor(Math.random() * 1_000_000_000);
document.getElementById("examId").innerText = seed;

// choose set A/B/C based on seed
const sets = ["A","B","C"];
const chosenSet = sets[seed % sets.length];

function createExamFromSeed() {
    // 1. filter by set
    let pool = rawQuestions.filter(q => q.set === chosenSet);
    // if not enough, just fall back to all
    if (pool.length < 30) {
        pool = rawQuestions.slice();
    }

    // 2. seeded shuffle pool
    seededShuffle(pool, seed);

    // 3. take first 30
    const selected = pool.slice(0, 30);

    // 4. shuffle options per question (deterministically)
    examQuestions = selected.map((q, idx) => {
        const optionsCopy = q.options.slice();
        const correctOption = q.options[q.answer];

        // use a derived seed for each question
        const qSeed = seed + idx * 9973;
        seededShuffle(optionsCopy, qSeed);

        const newAnswerIndex = optionsCopy.indexOf(correctOption);

        return {
            set: q.set,
            level: q.level,
            q: q.q,
            options: optionsCopy,
            answer: newAnswerIndex
        };
    });

    userAnswers = new Array(examQuestions.length).fill(null);
}

createExamFromSeed();

/* ===========================
   4. UI + Exam Logic
   =========================== */

function renderSidebar() {
    let html = "";
    for (let i = 0; i < examQuestions.length; i++) {
        html += `<div class="q-btn" id="qbtn${i}" onclick="jumpTo(${i})">${i+1}</div>`;
    }
    document.getElementById("questionButtons").innerHTML = html;
}

function loadQuestion() {
    const q = examQuestions[current];
    const quizDiv = document.getElementById("quiz");

    quizDiv.innerHTML = `
        <div class="question-box">
            <h2>Question ${current + 1}</h2>
            <div class="question-meta">
                Set: ${q.set} ‚Ä¢ Level: ${q.level}
            </div>
            <p>${q.q}</p>

            <div class="options">
                ${q.options.map((opt, i) => `
                    <label>
                        <input type="radio" name="q${current}" value="${i}"
                        ${userAnswers[current] === i ? "checked" : ""} ${examSubmitted ? "disabled" : ""}>
                        ${opt}
                    </label>
                `).join("")}
            </div>
        </div>
    `;

    updateSidebar();
    updateProgress();
    updateNavButtons();
}

function saveAnswer() {
    if (examSubmitted) return;
    const selected = document.querySelector(`input[name="q${current}"]:checked`);
    if (selected) {
        userAnswers[current] = parseInt(selected.value);
    }
}

function nextQuestion() {
    if (examSubmitted) return;
    saveAnswer();
    if (current < examQuestions.length - 1) {
        current++;
        loadQuestion();
    }
}

function prevQuestion() {
    if (examSubmitted) return;
    saveAnswer();
    if (current > 0) {
        current--;
        loadQuestion();
    }
}

function jumpTo(n) {
    if (examSubmitted) return;
    saveAnswer();
    current = n;
    loadQuestion();
}

function updateSidebar() {
    for (let i = 0; i < examQuestions.length; i++) {
        const btn = document.getElementById(`qbtn${i}`);
        btn.classList.remove("q-current", "q-answered", "q-locked");

        if (i === current) btn.classList.add("q-current");
        if (userAnswers[i] !== null) btn.classList.add("q-answered");
        if (examSubmitted) btn.classList.add("q-locked");
    }
}

function updateProgress() {
    const answered = userAnswers.filter(a => a !== null).length;
    const pct = (answered / examQuestions.length) * 100;
    document.getElementById("progressBar").style.width = pct + "%";
}

function updateNavButtons() {
    document.getElementById("prevBtn").disabled = examSubmitted || current === 0;
    document.getElementById("nextBtn").disabled = examSubmitted || current === examQuestions.length - 1;
    document.getElementById("submitBtn").disabled = examSubmitted;
}

/* ===========================
   5. Submit / Lock / Result
   =========================== */

function disableAllRadios() {
    document.querySelectorAll("input[type='radio']").forEach(r => r.disabled = true);
}

function submitQuiz() {
    if (examSubmitted) return;

    saveAnswer();

    // require all answers
    if (userAnswers.includes(null)) {
        alert("You must answer ALL questions before submitting.");
        return;
    }

    examSubmitted = true;
    disableAllRadios();
    updateSidebar();
    updateNavButtons();

    let score = 0;
    for (let i = 0; i < examQuestions.length; i++) {
        if (userAnswers[i] === examQuestions[i].answer) {
            score++;
        }
    }
    console.log("Student Answers:", JSON.stringify(userAnswers));
    const percent = Math.round((score / examQuestions.length) * 100);
    const passMark = 70;
    const status = percent >= passMark ? "PASSED ‚úÖ" : "FAILED ‚ùå";

    document.getElementById("resultText").innerText =
        `Score: ${score} / ${examQuestions.length} (${percent}%)\nStatus: ${status}\nExam ID: ${seed}`;

    document.getElementById("resultOverlay").style.display = "flex";
}

/* ===========================
   6. Timer (45 min, auto-submit)
   =========================== */

let time = 30 * 60; // 45 minutes

function updateTimer() {
    const minutes = Math.floor(time / 60);
    const seconds = time % 60;

    document.getElementById("timer").innerHTML =
        "Time Left: " + minutes + ":" + (seconds < 10 ? "0" + seconds : seconds);

    if (time <= 0) {
        if (!examSubmitted) {
            alert("Time is over. The exam will be submitted automatically.");
            submitQuiz();
        }
    } else {
        time--;
    }
}

setInterval(updateTimer, 1000);

/* ===========================
   7. Init
   =========================== */

renderSidebar();
loadQuestion();
function copyAnswers() {
    const examId = document.getElementById("examId").innerText;

    const dataToCopy = 
`Exam ID: ${examId}
Answers: ${JSON.stringify(userAnswers)}`;

    navigator.clipboard.writeText(dataToCopy).then(() => {
        alert("Copied!\n\nNow share the Exam ID + Answers with your teacher.");
    });
}

</script>

</body>
</html>
